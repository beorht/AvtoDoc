###  Тема урока
#### Тема № 11: Классификация асимметричных криптосистем по типу задачи. RSA, Эль-Гамаль и OpenSSL.

Основные разделы образовательного материала:
1.  Основы асимметричной криптографии и математические "сложные задачи".
2.  Алгоритм RSA: Принципы работы, генерация ключей и операции шифрования/расшифрования.
3.  Алгоритм Эль-Гамаля: Основы дискретного логарифмирования и связь с эллиптическими кривыми.
4.  Практическое применение: Шифрование данных с помощью библиотеки OpenSSL (RSA и принципы Эль-Гамаля).

Текст образовательного материала:

### Введение
Асимметричная криптография, также известная как криптография с открытым ключом, является краеугольным камнем современной информационной безопасности. В отличие от симметричных систем, использующих один и тот же ключ для шифрования и расшифрования, асимметричные системы применяют пару ключей: открытый ключ (public key), который может быть опубликован, и закрытый ключ (private key), который должен храниться в строжайшем секрете. Безопасность этих систем основывается на математических проблемах, которые легко сформулировать, но крайне сложно решить без обладания закрытым ключом. Сегодня мы рассмотрим классификацию этих систем по типу используемой "сложной задачи", углубимся в принципы работы алгоритмов RSA и Эль-Гамаля, а также продемонстрируем их использование с помощью библиотеки OpenSSL.

### 1. Основы асимметричной криптографии и математические "сложные задачи"

Асимметричные криптосистемы работают по принципу, что знание открытого ключа позволяет зашифровать сообщение, но не позволяет его расшифровать. Для расшифрования требуется соответствующий закрытый ключ. Эта концепция стала революционной, поскольку она решила проблему безопасного обмена ключами в симметричной криптографии, где ключи должны быть переданы по защищенному каналу.

Безопасность асимметричных алгоритмов зиждется на так называемых "односторонних функциях с лазейкой" (one-way functions with a trapdoor). Это функции, которые легко вычислить в одном направлении, но очень трудно обратить без дополнительной информации (лазейки). Лазейка в данном случае — это закрытый ключ.

Существует несколько основных математических "сложных задач", на которых строятся асимметричные криптосистемы:

*   **Проблема факторизации целых чисел (Integer Factorization Problem, IFP):** Суть задачи состоит в разложении большого составного числа на его простые множители. Если составное число достаточно велико и является произведением двух очень больших простых чисел, его факторизация считается вычислительно неосуществимой для современных компьютеров. На этой проблеме основан алгоритм RSA.

*   **Проблема дискретного логарифмирования (Discrete Logarithm Problem, DLP):** В конечном циклическом поле или группе, если известно $g$ (генератор), $p$ (модуль) и $y = g^x \pmod{p}$, то найти $x$ (дискретный логарифм) является очень сложной задачей, если $p$ достаточно велико. На этой проблеме основаны алгоритмы Диффи-Хеллмана и Эль-Гамаля.

*   **Проблема дискретного логарифмирования на эллиптических кривых (Elliptic Curve Discrete Logarithm Problem, ECDLP):** Это аналог DLP, но использующий групповую структуру точек на эллиптической кривой над конечным полем. ECDLP считается более сложной задачей, чем классическая DLP для того же размера поля, что позволяет использовать меньшие размеры ключей для достижения эквивалентного уровня безопасности. На этой проблеме основана криптография на эллиптических кривых (ECC), включая схемы Диффи-Хеллмана на эллиптических кривых (ECDH) и алгоритмы цифровой подписи на эллиптических кривых (ECDSA).

*   **Другие проблемы:** Существуют и другие классы проблем, например, основанные на решетках (Lattice-based cryptography), кодах (Code-based cryptography) или хэш-функциях (Hash-based cryptography), которые активно исследуются в контексте постквантовой криптографии.

### 2. Алгоритм RSA: Принципы работы, генерация ключей и операции шифрования/расшифрования

RSA (Rivest-Shamir-Adleman) является одним из первых и наиболее широко используемых асимметричных криптографических алгоритмов, разработанным в 1977 году. Его безопасность основана на сложности факторизации больших целых чисел.

#### 2.1. Генерация ключей RSA

1.  **Выбор двух больших простых чисел ($p, q$):** Выбираются два различных, очень больших случайных простых числа. Чем больше $p$ и $q$, тем безопаснее алгоритм.
2.  **Вычисление модуля ($n$):** Вычисляется произведение $n = p \cdot q$. Число $n$ является частью как открытого, так и закрытого ключа. Его длина (обычно 1024, 2048, 4096 бит) определяет стойкость.
3.  **Вычисление функции Эйлера ($\phi(n)$):** Вычисляется $\phi(n) = (p-1)(q-1)$. Это значение также известно как тотиент Эйлера.
4.  **Выбор открытой экспоненты ($e$):** Выбирается целое число $e$ такое, что $1 < e < \phi(n)$ и $e$ взаимно просто с $\phi(n)$ (т.е. $\text{НОД}(e, \phi(n)) = 1$). Часто используются небольшие значения $e$, например, $65537$.
5.  **Вычисление закрытой экспоненты ($d$):** Вычисляется $d$ как мультипликативное обратное к $e$ по модулю $\phi(n)$. Это означает, что $d \cdot e \equiv 1 \pmod{\phi(n)}$. Значение $d$ можно найти с помощью расширенного алгоритма Евклида.

*   **Публичный ключ:** Пара $(n, e)$.
*   **Приватный ключ:** Пара $(n, d)$. (или $(p, q, d)$ для оптимизации)

#### 2.2. Шифрование сообщения

Пусть Алиса хочет отправить зашифрованное сообщение $M$ Бобу, используя его открытый ключ $(n, e)$.
1.  Алиса преобразует сообщение $M$ в целое число (или последовательность чисел), такое что $0 \le M < n$.
2.  Алиса вычисляет шифротекст $C$ по формуле:
    $C = M^e \pmod{n}$
3.  Алиса отправляет $C$ Бобу.

#### 2.3. Расшифрование сообщения

Боб получает шифротекст $C$ и использует свой закрытый ключ $(n, d)$ для расшифрования.
1.  Боб вычисляет исходное сообщение $M$ по формуле:
    $M = C^d \pmod{n}$

Безопасность RSA заключается в том, что хотя $n$ и $e$ общеизвестны, для нахождения $d$ необходимо знать $\phi(n)$, а для этого необходимо факторизовать $n$ на $p$ и $q$. Если $p$ и $q$ достаточно велики (например, по 1024 бита каждый), эта задача становится невыполнимой для современных вычислительных средств.

### 3. Алгоритм Эль-Гамаля: Основы дискретного логарифмирования и связь с эллиптическими кривыми

Алгоритм Эль-Гамаля, разработанный Тахером Эль-Гамалем в 1985 году, является асимметричным криптографическим алгоритмом, основанным на проблеме дискретного логарифмирования (DLP).

#### 3.1. Генерация ключей Эль-Гамаля (в конечном поле)

1.  **Выбор большого простого числа ($p$):** Выбирается большое случайное простое число $p$.
2.  **Выбор генератора ($g$):** Выбирается генератор $g$ циклической группы $(\mathbb{Z}/p\mathbb{Z})^*$, то есть $g$ является примитивным корнем по модулю $p$.
3.  **Выбор закрытого ключа ($x$):** Выбирается случайное целое число $x$ такое, что $1 < x < p-1$. $x$ является закрытым ключом.
4.  **Вычисление открытого ключа ($y$):** Вычисляется $y = g^x \pmod{p}$.

*   **Публичный ключ:** Кортеж $(p, g, y)$.
*   **Приватный ключ:** Число $x$.

#### 3.2. Шифрование сообщения

Пусть Алиса хочет отправить зашифрованное сообщение $M$ Бобу, используя его открытый ключ $(p, g, y)$.
1.  Алиса преобразует сообщение $M$ в целое число, $0 \le M < p$.
2.  Алиса выбирает случайное целое число $k$ (сессионный ключ) такое, что $1 < k < p-1$.
3.  Алиса вычисляет два компонента шифротекста:
    *   $a = g^k \pmod{p}$
    *   $b = M \cdot y^k \pmod{p}$
4.  Алиса отправляет пару $(a, b)$ Бобу.

#### 3.3. Расшифрование сообщения

Боб получает шифротекст $(a, b)$ и использует свой закрытый ключ $x$ для расшифрования.
1.  Боб вычисляет $s = a^x \pmod{p}$.
2.  Боб находит мультипликативное обратное к $s$ по модулю $p$, обозначаемое $s^{-1}$.
3.  Боб вычисляет исходное сообщение $M$ по формуле:
    $M = b \cdot s^{-1} \pmod{p}$
    (Так как $b \cdot s^{-1} \equiv (M \cdot y^k) \cdot (a^x)^{-1} \equiv (M \cdot (g^x)^k) \cdot (g^k)^x)^{-1} \equiv (M \cdot g^{xk}) \cdot (g^{kx})^{-1} \equiv M \pmod{p}$)

Безопасность Эль-Гамаля основана на сложности проблемы дискретного логарифмирования. Злоумышленник, зная $p, g, y$, не может эффективно найти $x$, а зная $p, g, a, b$, не может эффективно найти $M$ без знания $x$.

#### 3.4. Связь с эллиптическими кривыми

В оригинальной формулировке алгоритм Эль-Гамаля использует мультипликативную группу целых чисел по модулю $p$. Однако его фундаментальные принципы, основанные на проблеме дискретного логарифмирования, могут быть адаптированы для использования с другими циклическими группами, в частности, с группой точек на эллиптической кривой над конечным полем.

В контексте **криптографии на эллиптических кривых (ECC)**, DLP заменяется на **проблему дискретного логарифмирования на эллиптических кривых (ECDLP)**. Вместо операции возведения в степень $g^x$, используется скалярное умножение точки на эллиптической кривой: $xG$, где $G$ — базовая точка на кривой, а $x$ — скаляр (целое число).

Алгоритм, который в ECC выполняет роль шифрования и подписания, аналогичную Эль-Гамалю, часто называют **Elliptic Curve Integrated Encryption Scheme (ECIES)** для шифрования или **Elliptic Curve Digital Signature Algorithm (ECDSA)** для подписи. Таким образом, хотя сам алгоритм Эль-Гамаля традиционно основан на DLP в конечных полях, его концептуальные идеи являются предшественниками и вдохновителями для построения криптосхем на эллиптических кривых. Утверждение, что "алгоритм Эль-Гамаля является наиболее широко используемым алгоритмом шифрования, основанным на эллиптической кривой", является несколько неточным. Скорее, принципы, лежащие в основе Эль-Гамаля (использование DLP), были успешно перенесены в более эффективные и компактные схемы на эллиптических кривых, такие как ECIES, которые стали очень популярными.

### 4. Практическое применение: Шифрование данных с помощью библиотеки OpenSSL (RSA и принципы Эль-Гамаля)

OpenSSL — это мощная криптографическая библиотека с открытым исходным кодом, предоставляющая инструменты для реализации различных криптографических протоколов и алгоритмов, включая RSA и Диффи-Хеллмана (основу Эль-Гамаля). Для шифрования больших объемов данных асимметричные алгоритмы обычно используются в гибридных схемах: асимметричная криптография применяется для безопасного обмена симметричными ключами, которые затем используются для шифрования самого сообщения.

#### 4.1. Шифрование данных с помощью RSA в OpenSSL (гибридная схема)

Пример гибридного шифрования файла `plaintext.txt` с использованием RSA для ключа AES-256.

**Предварительные шаги:** Создадим файл с данными для шифрования.
```bash
echo "Это секретное сообщение, которое будет зашифровано с помощью RSA и AES." > plaintext.txt
```

**1. Генерация пары ключей RSA (закрытый и открытый):**
Создадим закрытый ключ с длиной 2048 бит и зашифруем его с помощью AES-256.
```bash
openssl genpkey -algorithm RSA -out rsa_private_key.pem -aes256
# При запросе пароля введите, например, "mypassword"
```
Извлечем открытый ключ из закрытого:
```bash
openssl pkey -in rsa_private_key.pem -pubout -out rsa_public_key.pem -passin pass:mypassword
```

**2. Шифрование файла:**
*   **Генерация случайного симметричного ключа (для AES-256):**
    ```bash
    openssl rand -base64 32 > aes_key.bin
    ```
*   **Шифрование данных симметричным ключом (AES-256):**
    ```bash
    openssl enc -aes256 -salt -in plaintext.txt -out encrypted_data.bin -pass file:aes_key.bin
    ```
*   **Шифрование симметричного ключа RSA открытым ключом получателя:**
    ```bash
    openssl pkeyutl -encrypt -in aes_key.bin -out encrypted_aes_key.bin -pubin -inkey rsa_public_key.pem
    ```
Теперь у нас есть `encrypted_data.bin` (зашифрованный файл) и `encrypted_aes_key.bin` (зашифрованный симметричный ключ). Эти два файла могут быть безопасно переданы получателю.

**3. Расшифрование файла:**
Получатель имеет свой закрытый ключ RSA (`rsa_private_key.pem`) и полученные зашифрованные файлы.
*   **Расшифрование симметричного ключа RSA закрытым ключом получателя:**
    ```bash
    openssl pkeyutl -decrypt -in encrypted_aes_key.bin -out decrypted_aes_key.bin -inkey rsa_private_key.pem -passin pass:mypassword
    ```
*   **Расшифрование данных симметричным ключом:**
    ```bash
    openssl enc -d -aes256 -in encrypted_data.bin -out decrypted_plaintext.txt -pass file:decrypted_aes_key.bin
    ```
Проверим содержимое `decrypted_plaintext.txt`:
```bash
cat decrypted_plaintext.txt
# Должно вывести: "Это секретное сообщение, которое будет зашифровано с помощью RSA и AES."
```

#### 4.2. Использование принципов Эль-Гамаля (Диффи-Хеллман) в OpenSSL

Как упоминалось, прямой команды `openssl pkeyutl -encrypt -alg ElGamal` для шифрования сообщений не существует в консольных утилитах OpenSSL. Однако OpenSSL полностью поддерживает базовые принципы, лежащие в основе Эль-Гамаля – а именно, обмен ключами Диффи-Хеллмана (DH), который основан на проблеме дискретного логарифмирования. Мы можем продемонстрировать, как две стороны могут сгенерировать общий секретный ключ.

**1. Генерация параметров Диффи-Хеллмана:**
Параметры ($p, g$) могут быть сгенерированы одной стороной и использованы обеими.
```bash
openssl dhparam -out dh_params.pem 2048
```
Это создает файл `dh_params.pem`, содержащий большое простое число $p$ и генератор $g$.

**2. Генерация ключей для Алисы:**
```bash
openssl genpkey -paramfile dh_params.pem -out alice_private.pem
openssl pkey -in alice_private.pem -pubout -out alice_public.pem
```
`alice_private.pem` содержит секретный $x_A$, а `alice_public.pem` содержит $y_A = g^{x_A} \pmod{p}$.

**3. Генерация ключей для Боба:**
```bash
openssl genpkey -paramfile dh_params.pem -out bob_private.pem
openssl pkey -in bob_private.pem -pubout -out bob_public.pem
```
`bob_private.pem` содержит секретный $x_B$, а `bob_public.pem` содержит $y_B = g^{x_B} \pmod{p}$.

**4. Вычисление общего секрета:**
*   **Алиса вычисляет общий секрет, используя свой закрытый ключ и открытый ключ Боба:**
    ```bash
    openssl pkeyutl -derive -inkey alice_private.pem -peerkey bob_public.pem -out alice_shared_secret.bin
    ```
*   **Боб вычисляет общий секрет, используя свой закрытый ключ и открытый ключ Алисы:**
    ```bash
    openssl pkeyutl -derive -inkey bob_private.pem -peerkey alice_public.pem -out bob_shared_secret.bin
    ```
Теперь `alice_shared_secret.bin` и `bob_shared_secret.bin` должны содержать одинаковые данные (производный ключ $g^{x_A x_B} \pmod{p}$), который можно использовать как симметричный ключ для шифрования данных.

Проверим, что ключи идентичны:
```bash
cmp alice_shared_secret.bin bob_shared_secret.bin && echo "Shared secrets match." || echo "Shared secrets DO NOT match."
```
Этот общий секрет (аналог $s = y^k \pmod{p}$ или $s = a^x \pmod{p}$ в Эль-Гамале) затем может быть использован для получения симметричного ключа (например, с помощью функции деривации ключа KDF) и шифрования/расшифрования данных, аналогично гибридной схеме с RSA.

### Заключение

Асимметричные криптосистемы играют незаменимую роль в современной безопасности, предоставляя средства для безопасного обмена ключами, шифрования сообщений и цифровых подписей. Их классификация по типу лежащей в основе "сложной задачи" помогает понять фундаментальные принципы их работы и потенциальные уязвимости. RSA, опирающийся на проблему факторизации, и Эль-Гамаль (и его производные), основанный на проблеме дискретного логарифмирования, являются двумя яркими примерами таких систем. Понимание этих алгоритмов и умение применять их с помощью таких инструментов, как OpenSSL, являются ключевыми навыками для любого специалиста в области информационной безопасности. С развитием квантовых компьютеров появляются новые "сложные задачи" и алгоритмы (например, постквантовая криптография), но фундаментальные принципы построения криптосистем на базе односторонних функций останутся актуальными.
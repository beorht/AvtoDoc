###  Тема урока
#### Тема № 17: Генерация ЭЦП на основе алгоритмов RSA, DSA, ECDSA с использованием библиотеки OpenSSL

Основные разделы образовательного материала:
1.  Введение: Что такое ЭЦП и почему OpenSSL?
2.  Общие принципы генерации и проверки ЭЦП.
3.  Генерация ЭЦП с использованием алгоритмов RSA, DSA и ECDSA (теория и OpenSSL).
4.  Сравнение алгоритмов и рекомендации по выбору.
5.  Заключение.

 

### Текст образовательного материала:

### 1. Введение: Что такое ЭЦП и почему OpenSSL?

Уважаемые слушатели, добро пожаловать на лекцию, посвященную одному из краеугольных камней современной информационной безопасности – электронной цифровой подписи (ЭЦП). В мире, где цифровые транзакции и обмен данными стали нормой, критически важно иметь механизмы для подтверждения подлинности, целостности и неотрекаемости информации. Именно эти задачи решает ЭЦП.

**Что такое Электронная Цифровая Подпись (ЭЦП)?**
ЭЦП — это криптографический механизм, который позволяет отправителю цифрового сообщения (документа, файла, транзакции) однозначно подтвердить свое авторство и гарантировать, что сообщение не было изменено после подписания. Она обеспечивает три ключевых аспекта:
*   **Аутентичность:** Подтверждает, что данные пришли от заявленного отправителя.
*   **Целостность:** Гарантирует, что данные не были изменены после того, как были подписаны.
*   **Неотрекаемость:** Предотвращает возможность отправителю отказаться от факта подписи.

ЭЦП является цифровым аналогом собственноручной подписи и имеет юридическую силу во многих странах мира, включая Российскую Федерацию, где ее использование регулируется Федеральным законом № 63-ФЗ "Об электронной подписи".

**Почему OpenSSL?**
Для реализации криптографических операций, таких как генерация ЭЦП, мы будем использовать библиотеку OpenSSL. OpenSSL — это мощная, многофункциональная и широко используемая криптографическая библиотека с открытым исходным кодом. Она предоставляет инструменты командной строки и API для широкого спектра криптографических задач, включая:
*   Генерацию ключевых пар (RSA, DSA, ECDSA).
*   Создание и проверку цифровых подписей.
*   Шифрование и дешифрование данных.
*   Управление сертификатами X.509 и центрами сертификации (CA).
*   Реализацию протоколов SSL/TLS.

OpenSSL является де-факто стандартом в индустрии, поддерживается на множестве платформ и активно развивается сообществом, что делает ее надежным и актуальным инструментом для изучения и применения криптографии.

В рамках данной лекции мы подробно рассмотрим, как генерировать ЭЦП, используя три основных асимметричных криптографических алгоритма: RSA, DSA и ECDSA, с практической демонстрацией через OpenSSL.

### 2. Общие принципы генерации и проверки ЭЦП

Прежде чем углубляться в детали конкретных алгоритмов, давайте рассмотрим универсальную схему работы ЭЦП. Все алгоритмы ЭЦП следуют одному и тому же фундаментальному принципу, включающему два основных этапа: генерацию подписи и проверку подписи.

**2.1. Генерация ключевой пары**
В основе асимметричной криптографии лежит концепция ключевой пары:
*   **Приватный (закрытый) ключ:** Должен храниться в строжайшей тайне владельцем. Используется для *генерации* подписи.
*   **Публичный (открытый) ключ:** Может быть свободно распространен. Используется для *проверки* подписи.

**2.2. Генерация подписи**
Процесс создания ЭЦП состоит из следующих шагов:
1.  **Формирование исходного сообщения:** Это может быть текстовый документ, файл, набор байт – любая информация, которую необходимо подписать.
2.  **Вычисление хеша сообщения:** Исходное сообщение пропускается через криптографическую хеш-функцию (например, SHA-256, SHA-3). Хеш-функция необратимо преобразует сообщение произвольной длины в уникальную строку фиксированной длины (дайджест сообщения или отпечаток). Основные свойства хеш-функции:
    *   **Необратимость:** Невозможно восстановить исходное сообщение по его хешу.
    *   **Устойчивость к коллизиям:** Крайне маловероятно, что два разных сообщения дадут один и тот же хеш.
    *   **Лавинный эффект:** Небольшое изменение в исходном сообщении приводит к совершенно другому хешу.
    *   Использование хеша вместо всего сообщения существенно ускоряет процесс подписи и уменьшает размер подписи.
3.  **Шифрование хеша приватным ключом:** Полученный хеш сообщения шифруется (точнее, трансформируется) приватным ключом отправителя. Результатом этой операции является **электронная цифровая подпись**.

Таким образом, ЭЦП – это хеш сообщения, зашифрованный приватным ключом.

**2.3. Проверка подписи**
Процесс проверки ЭЦП выполняется получателем сообщения и включает следующие шаги:
1.  **Получение сообщения, подписи и публичного ключа:** Получатель получает исходное сообщение, прикрепленную к нему ЭЦП и публичный ключ отправителя.
2.  **Вычисление хеша полученного сообщения:** Получатель самостоятельно вычисляет хеш полученного сообщения, используя ту же хеш-функцию, что и отправитель.
3.  **Расшифровка подписи публичным ключом:** Получатель использует публичный ключ отправителя, чтобы расшифровать (трансформировать обратно) полученную ЭЦП. В результате этой операции он получает хеш, который был изначально зашифрован приватным ключом отправителя.
4.  **Сравнение хешей:** Получатель сравнивает два хеша: хеш, который он вычислил сам (шаг 2), и хеш, который он извлек из подписи (шаг 3).
    *   Если хеши совпадают, это означает, что подпись действительна: сообщение не было изменено, и оно было подписано владельцем приватного ключа, соответствующего данному публичному ключу.
    *   Если хеши не совпадают, подпись недействительна: либо сообщение было изменено, либо подпись была сделана другим ключом, либо подпись повреждена.

**Вывод:** Общие принципы ЭЦП универсальны для всех алгоритмов, меняется лишь математическая основа операций "шифрования хеша приватным ключом" и "расшифровки публичным ключом".

### 3. Генерация ЭЦП с использованием алгоритмов RSA, DSA и ECDSA (теория и OpenSSL)

Теперь рассмотрим конкретные алгоритмы и их реализацию в OpenSSL.

Для всех примеров предположим, что у нас есть файл `message.txt` с содержимым, которое мы хотим подписать:
```bash
echo "Это тестовое сообщение для подписи." > message.txt
```

#### 3.1. Алгоритм RSA (Rivest-Shamir-Adleman)

**Теория RSA:**
RSA — это один из первых и наиболее широко используемых алгоритмов асимметричной криптографии. Его безопасность основана на вычислительной сложности задачи факторизации больших чисел. RSA может использоваться как для шифрования, так и для цифровой подписи. Для ЭЦП, как мы уже говорили, фактически шифруется не сообщение, а его хеш. Размер ключа RSA обычно составляет от 1024 до 4096 бит. Чем больше ключ, тем выше безопасность, но и медленнее операции.

**Практика с OpenSSL (RSA):**

1.  **Генерация приватного RSA-ключа:**
    Мы сгенерируем приватный ключ длиной 2048 бит.
    ```bash
    openssl genrsa -out private_rsa.pem 2048
    ```
    *   `genrsa`: команда для генерации RSA-ключа.
    *   `-out private_rsa.pem`: имя файла для сохранения приватного ключа.
    *   `2048`: длина ключа в битах.
    *   *Примечание:* Можно добавить `-aes256` для шифрования приватного ключа паролем.

2.  **Извлечение публичного RSA-ключа из приватного:**
    ```bash
    openssl rsa -in private_rsa.pem -pubout -out public_rsa.pem
    ```
    *   `rsa`: утилита для работы с RSA-ключами.
    *   `-in private_rsa.pem`: входной файл с приватным ключом.
    *   `-pubout`: указывает на вывод только публичной части ключа.
    *   `-out public_rsa.pem`: имя файла для сохранения публичного ключа.

3.  **Генерация подписи RSA:**
    Мы подпишем файл `message.txt` с использованием хеш-функции SHA256 и приватного ключа RSA.
    ```bash
    openssl dgst -sha256 -sign private_rsa.pem -out signature_rsa.sig message.txt
    ```
    *   `dgst`: утилита для вычисления хешей и создания/проверки подписей.
    *   `-sha256`: используемая хеш-функция.
    *   `-sign private_rsa.pem`: указывает на создание подписи с помощью указанного приватного ключа.
    *   `-out signature_rsa.sig`: имя файла для сохранения результирующей подписи.
    *   `message.txt`: исходный файл для подписи.

4.  **Проверка подписи RSA:**
    Проверим подпись с использованием публичного ключа RSA и исходного файла.
    ```bash
    openssl dgst -sha256 -verify public_rsa.pem -signature signature_rsa.sig message.txt
    ```
    *   `-verify public_rsa.pem`: указывает на проверку подписи с помощью указанного публичного ключа.
    *   `-signature signature_rsa.sig`: файл, содержащий ЭЦП.
    *   Если подпись верна, OpenSSL выведет `Verified OK`. В противном случае – `Verification Failure`.

**Вывод по RSA:** RSA является универсальным и широко поддерживаемым алгоритмом. Его ключи достаточно велики, и операции подписи/проверки могут быть относительно медленными по сравнению с эллиптическими кривыми, особенно при больших размерах ключей.

#### 3.2. Алгоритм DSA (Digital Signature Algorithm)

**Теория DSA:**
DSA — это федеральный стандарт США для цифровой подписи, основанный на задаче дискретного логарифмирования. В отличие от RSA, DSA предназначен *исключительно* для генерации и проверки цифровых подписей; его нельзя использовать для шифрования. Ключи DSA включают несколько параметров: `p`, `q`, `g`, `x` (приватный) и `y` (публичный). Безопасность DSA сильно зависит от правильного выбора параметров `p` и `q`.

**Практика с OpenSSL (DSA):**

1.  **Генерация параметров DSA:**
    DSA требует предварительной генерации параметров (`p` и `q`), которые могут быть общими для группы пользователей.
    ```bash
    openssl dsaparam -out dsaparam.pem 2048
    ```
    *   `dsaparam`: команда для генерации параметров DSA.
    *   `-out dsaparam.pem`: имя файла для сохранения параметров.
    *   `2048`: длина параметра `p` (в битах).

2.  **Генерация приватного DSA-ключа с использованием параметров:**
    ```bash
    openssl gendsa -out private_dsa.pem dsaparam.pem
    ```
    *   `gendsa`: команда для генерации DSA-ключа.
    *   `-out private_dsa.pem`: имя файла для приватного ключа.
    *   `dsaparam.pem`: файл с ранее сгенерированными параметрами.

3.  **Извлечение публичного DSA-ключа:**
    ```bash
    openssl dsa -in private_dsa.pem -pubout -out public_dsa.pem
    ```
    *   `dsa`: утилита для работы с DSA-ключами.
    *   `-in private_dsa.pem`: входной файл с приватным ключом.
    *   `-pubout`: указывает на вывод публичной части ключа.
    *   `-out public_dsa.pem`: имя файла для публичного ключа.

4.  **Генерация подписи DSA:**
    ```bash
    openssl dgst -sha256 -sign private_dsa.pem -out signature_dsa.sig message.txt
    ```
    *   Аналогично RSA, используем `dgst`.

5.  **Проверка подписи DSA:**
    ```bash
    openssl dgst -sha256 -verify public_dsa.pem -signature signature_dsa.sig message.txt
    ```
    *   Аналогично RSA, используем `dgst`. Результат: `Verified OK` или `Verification Failure`.

**Вывод по DSA:** DSA является эффективным алгоритмом для подписи, но его использование менее распространено, чем RSA или ECDSA, отчасти из-за сложности управления общими параметрами и отсутствия возможности шифрования.

#### 3.3. Алгоритм ECDSA (Elliptic Curve Digital Signature Algorithm)

**Теория ECDSA:**
ECDSA — это версия DSA, адаптированная для использования с криптографией на эллиптических кривых (ECC). Безопасность ECC основана на вычислительной сложности задачи дискретного логарифмирования на эллиптических кривых. Главное преимущество ECDSA перед RSA и DSA заключается в том, что оно обеспечивает такой же уровень безопасности при значительно меньших размерах ключей. Это приводит к более быстрым вычислениям, меньшим размерам подписей и меньшему потреблению ресурсов, что делает ECDSA идеальным для мобильных устройств, интернета вещей и блокчейн-технологий.

**Практика с OpenSSL (ECDSA):**

1.  **Генерация приватного ECDSA-ключа:**
    Для ECDSA мы выбираем предопределенную эллиптическую кривую. Одной из часто используемых является `prime256v1` (также известная как `secp256r1`).
    ```bash
    openssl ecparam -name prime256v1 -genkey -noout -out private_ecdsa.pem
    ```
    *   `ecparam`: команда для работы с параметрами эллиптических кривых.
    *   `-name prime256v1`: имя используемой кривой (стандартные имена можно посмотреть `openssl ecparam -list_curves`).
    *   `-genkey`: указывает на генерацию ключа.
    *   `-noout`: предотвращает вывод параметров кривой в консоль.
    *   `-out private_ecdsa.pem`: имя файла для сохранения приватного ключа.

2.  **Извлечение публичного ECDSA-ключа:**
    ```bash
    openssl ec -in private_ecdsa.pem -pubout -out public_ecdsa.pem
    ```
    *   `ec`: утилита для работы с ключами эллиптических кривых.
    *   Остальные параметры аналогичны RSA и DSA.

3.  **Генерация подписи ECDSA:**
    ```bash
    openssl dgst -sha256 -sign private_ecdsa.pem -out signature_ecdsa.sig message.txt
    ```
    *   Аналогично RSA и DSA.

4.  **Проверка подписи ECDSA:**
    ```bash
    openssl dgst -sha256 -verify public_ecdsa.pem -signature signature_ecdsa.sig message.txt
    ```
    *   Аналогично RSA и DSA. Результат: `Verified OK` или `Verification Failure`.

**Вывод по ECDSA:** ECDSA является современным и высокоэффективным алгоритмом для цифровой подписи. Он предлагает отличный баланс между безопасностью, производительностью и размером ключей, становясь предпочтительным выбором для новых приложений.

### 4. Сравнение алгоритмов и рекомендации по выбору

Давайте подведем итоги и сравним рассмотренные алгоритмы:

| Характеристика          | RSA                                   | DSA                                   | ECDSA                                        |
| :       - | :             | :             | :              - |
| **Основа безопасности** | Факторизация больших чисел            | Дискретное логарифмирование           | Дискретное логарифмирование на эллиптических кривых |
| **Назначение**          | Подпись И Шифрование                  | Только Подпись                        | Только Подпись                               |
| **Размер ключа (пример для 128 бит безопасности)** | 3072 бит (и более)                    | 3072 бит (для `p`)                    | 256 бит (например, `prime256v1`)             |
| **Производительность**  | Подпись/проверка медленнее ECC        | Быстрее RSA, медленнее ECDSA          | Самая высокая (быстрее RSA и DSA)            |
| **Размер подписи**      | Больше, чем у ECDSA                   | Больше, чем у ECDSA                   | Самый маленький                              |
| **Распространенность**  | Очень высокая, исторически де-факто стандарт | Умеренная, уступает RSA и ECDSA       | Высокая, растет, стандарт для многих новых технологий |
| **Сложность управления**| Относительно простая                  | Требует общих параметров (p, q)       | Относительно простая, выбор кривой          |

**Рекомендации по выбору:**

*   **RSA:** Отличный выбор, если вам нужен универсальный алгоритм для шифрования и подписи, и совместимость со старыми системами является критичной. Обеспечивает надежную безопасность при достаточной длине ключа (рекомендуется 2048 бит и более).
*   **DSA:** Исторический стандарт для подписи, но менее предпочтителен в новых разработках по сравнению с ECDSA из-за его меньшей гибкости и худшей производительности на том же уровне безопасности по сравнению с ECC.
*   **ECDSA:** Наиболее современный и рекомендуемый алгоритм для цифровой подписи в большинстве новых приложений. Он предлагает наилучшее соотношение безопасности к размеру ключа, скорости выполнения операций и компактности подписи, что критично для ограниченных ресурсов и высокопроизводительных систем.

**Общие рекомендации:**
*   Всегда используйте достаточно длинные ключи (минимум 2048 бит для RSA/DSA, P-256 или P-384 для ECDSA).
*   Используйте надежные хеш-функции (SHA-256, SHA-384, SHA-512). Избегайте устаревших, таких как SHA-1 или MD5.
*   Обеспечьте безопасное хранение приватных ключей. Это самое уязвимое звено в системе ЭЦП.

### 5. Заключение

Электронная цифровая подпись является фундаментальным компонентом современной информационной безопасности, обеспечивая подлинность, целостность и неотрекаемость цифровых данных. Библиотека OpenSSL предоставляет мощные и гибкие инструменты для реализации ЭЦП с использованием различных криптографических алгоритмов, таких как RSA, DSA и ECDSA.

Мы рассмотрели теоретические основы каждого алгоритма и привели практические примеры их использования с помощью командной строки OpenSSL для генерации ключей, подписи сообщений и проверки подписей. Понимание этих алгоритмов и умение работать с OpenSSL являются важными навыками для любого специалиста в области информационной безопасности или разработки.

Выбор конкретного алгоритма зависит от требований вашего проекта, включая необходимый уровень безопасности, производительность, размер подписей и совместимость с существующими системами. В современных реалиях ECDSA часто является предпочтительным выбором благодаря своей эффективности и компактности.

Помните, что безопасность ЭЦП зависит не только от стойкости алгоритмов, но и от правильного управления ключами и соблюдения всех аспектов криптографической гигиены. Продолжайте изучать и практиковаться, чтобы стать экспертом в этой важной области!
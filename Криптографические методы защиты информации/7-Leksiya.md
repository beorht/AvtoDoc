###  Тема урока
#### Тема № 8: Методы создания блочных шифров. Режимы шифрования блоков. Современные методы блочного шифрования. DES, AES, DSt 1105:2009, ГОСТ Р 28147-89, Камелия, IDEA, Иглобрюх

Основные разделы образовательного материала:
1. Введение в блочные шифры: основные понятия и принципы.
2. Методы создания блочных шифров: конструкции Фейстеля и SP-сети.
3. Режимы шифрования блоков: ECB, CBC, OFB, CFB, CTR.
4. Современные блочные шифры: DES, AES, ГОСТ Р 28147-89, DSt 1105:2009 (Кузнечик), Камелия, IDEA, Blowfish.

Текст образовательного материала:

### 1. Введение в блочные шифры: основные понятия и принципы

Блочный шифр – это детерминированный алгоритм симметричного шифрования, который работает с блоками открытого текста фиксированной длины (например, 64, 128 бит) и преобразует их в блоки зашифрованного текста той же длины, используя секретный ключ. Если сообщение длиннее блока, оно разбивается на блоки, которые затем шифруются поочередно с использованием одного из *режимов шифрования блоков*.

Основные характеристики блочного шифра:
*   **Размер блока**: Длина входного блока открытого текста (и, соответственно, выходного блока зашифрованного текста). Типичные значения: 64 бита, 128 бит.
*   **Длина ключа**: Длина секретного ключа, используемого для шифрования и дешифрования. Типичные значения: 56, 128, 192, 256 бит.
*   **Число раундов**: Количество итераций, через которые проходит блок данных в процессе шифрования, каждая из которых включает в себя комбинацию подстановок и перестановок.
*   **Криптостойкость**: Способность шифра противостоять различным атакам (брутфорс, дифференциальный, линейный криптоанализ и т.д.).

Блочные шифры являются фундаментальным компонентом современной криптографии, используемым для защиты данных в хранилищах, сетевых протоколах, базах данных и многих других приложениях.

### 2. Методы создания блочных шифров: конструкции Фейстеля и SP-сети

Существуют две основные архитектуры для построения блочных шифров, каждая из которых имеет свои преимущества.

#### 2.1. Сеть Фейстеля (Feistel Network)

Конструкция Фейстеля – это подход к построению блочных шифров, предложенный Хорстом Фейстелем в IBM. Ее ключевое преимущество заключается в том, что функция шифрования `F` (раундовая функция) не обязательно должна быть обратимой, а весь алгоритм шифрования будет обратимым.

**Принцип работы**:
1.  **Разделение блока**: Входной блок открытого текста делится на две равные части: левую (L) и правую (R).
2.  **Раунды**: Шифрование состоит из нескольких раундов. В каждом раунде:
    *   Одна из частей (например, правая R) модифицируется с помощью раундовой функции `F`, которая принимает в качестве входных данных эту часть и подключает часть секретного ключа (подраунд-ключ `K_i`).
    *   Результат функции `F` складывается по модулю 2 (операция XOR) с другой частью блока (левой L).
    *   Части меняются местами: левая часть становится новой правой, а модифицированная правая часть становится новой левой.
3.  **Дешифрование**: Процесс дешифрования идентичен процессу шифрования, за исключением того, что подраунд-ключи применяются в обратном порядке.

**Примеры шифров на основе сети Фейстеля**: DES, ГОСТ Р 28147-89, Blowfish, Twofish, Camellia (гибрид).

#### 2.2. SP-сеть (Substitution-Permutation Network)

SP-сеть – это другая популярная архитектура, основанная на чередовании операций замещения (substitution) и перестановки (permutation). Она была разработана для обеспечения эффектов **рассеивания** (diffusion) и **перемешивания** (confusion), ключевых принципов криптографии, сформулированных Клодом Шенноном.

**Принцип работы**:
1.  **Замещение (Substitution)**: Блок данных проходит через нелинейные таблицы замещений (S-блоки). Каждый S-блок принимает несколько входных бит и выдает несколько выходных бит, заменяя их по предопределенной таблице. Это обеспечивает перемешивание.
2.  **Перестановка (Permutation)**: Биты выходных данных S-блоков затем переставляются (P-блок), распределяя их по всему блоку. Это обеспечивает рассеивание, гарантируя, что изменение одного бита входа влияет на множество битов выхода.
3.  **Раунды**: Шифрование состоит из нескольких раундов, каждый из которых включает применение S-блоков, P-блоков и добавление подраунд-ключа (обычно XOR).

**Преимущества SP-сетей**: Хорошо поддаются параллельной реализации, что обеспечивает высокую производительность.

**Примеры шифров на основе SP-сети**: AES (Rijndael), Serpent, Кузнечик (ГОСТ Р 34.12-2015), Camellia (гибрид).

### 3. Режимы шифрования блоков: ECB, CBC, OFB, CFB, CTR

Блочный шифр шифрует только один блок данных фиксированного размера. Для шифрования сообщений произвольной длины используются режимы шифрования, которые определяют, как последовательность блоков обрабатывается шифром.

#### 3.1. ECB (Electronic Codebook Mode – Режим электронной кодовой книги)

*   **Принцип**: Каждый блок открытого текста шифруется независимо от других блоков одним и тем же ключом.
*   **Достоинства**: Простой, позволяет параллельное шифрование и дешифрование.
*   **Недостатки**: Не обеспечивает конфиденциальность паттернов. Одинаковые блоки открытого текста всегда дают одинаковые блоки зашифрованного текста. Это делает его уязвимым для криптоанализа и нерекомендуемым для большинства применений.
*   **Применение**: Шифрование очень коротких сообщений, ключей (но с осторожностью).

#### 3.2. CBC (Cipher Block Chaining Mode – Режим сцепления блоков шифра)

*   **Принцип**: Каждый блок открытого текста XOR-ится с предыдущим блоком зашифрованного текста перед шифрованием. Для первого блока используется случайный *вектор инициализации* (IV), который должен быть уникальным для каждого сеанса шифрования и передаваться вместе с зашифрованным текстом.
*   **Достоинства**: Скрывает паттерны открытого текста, изменение одного бита в открытом тексте влияет на все последующие блоки.
*   **Недостатки**: Последовательное шифрование (нельзя параллелизовать), ошибка в одном блоке зашифрованного текста влияет на дешифрование следующего блока.
*   **Применение**: Шифрование файлов, сообщений, протоколов. Очень распространенный режим.

#### 3.3. OFB (Output Feedback Mode – Режим обратной связи по выходу)

*   **Принцип**: Блочный шифр используется как генератор ключевого потока. Вместо шифрования открытого текста, он шифрует предыдущий выходной блок шифра (или IV для первого блока) для создания ключевого потока. Этот ключевой поток затем XOR-ится с открытым текстом.
*   **Достоинства**: Потоковый режим, позволяет шифровать данные побитово или побайтно. Ошибки в зашифрованном тексте не распространяются.
*   **Недостатки**: Для генерации ключевого потока требуется последовательное выполнение. Если ключевой поток повторяется (из-за плохого IV или коллизии), это серьезная уязвимость.
*   **Применение**: Приложения, где данные поступают потоком и их нужно шифровать в реальном времени.

#### 3.4. CFB (Cipher Feedback Mode – Режим обратной связи по шифротексту)

*   **Принцип**: Похож на OFB, но для генерации ключевого потока использует предыдущий блок *зашифрованного текста* (или IV для первого блока). Блочный шифр работает в режиме генерации ключевого потока, который затем XOR-ится с открытым текстом.
*   **Достоинства**: Потоковый режим. Шифрование может быть побитовым или побайтовым.
*   **Недостатки**: Ошибка в зашифрованном тексте распространяется на несколько последующих блоков.
*   **Применение**: Схожие с OFB сценарии, но с другим механизмом обратной связи.

#### 3.5. CTR (Counter Mode – Режим счетчика)

*   **Принцип**: Для каждого блока данных генерируется уникальный "счетчик" (число, которое увеличивается с каждым блоком). Этот счетчик шифруется блочным шифром, и результат XOR-ится с соответствующим блоком открытого текста.
*   **Достоинства**: Полностью параллелизуем как для шифрования, так и для дешифрования. Потоковый режим. Ошибки не распространяются. Считается одним из лучших универсальных режимов.
*   **Недостатки**: Требует уникального счетчика для каждого блока с данным ключом, иначе возникает серьезная уязвимость повторного использования ключевого потока.
*   **Применение**: Широко используется для высокопроизводительных систем, файловых систем, облачных хранилищ, HTTPS.

### 4. Современные блочные шифры: DES, AES, ГОСТ Р 28147-89, DSt 1105:2009, Камелия, IDEA, Иглобрюх

Давайте рассмотрим некоторые ключевые блочные шифры, их историю, архитектуру и особенности.

#### 4.1. DES (Data Encryption Standard)

*   **История**: Разработан IBM в 1970-х годах, утвержден как федеральный стандарт США в 1977 году. Долгое время был де-факто мировым стандартом.
*   **Архитектура**: 16-раундовая сеть Фейстеля.
*   **Параметры**:
    *   Размер блока: 64 бита.
    *   Длина ключа: 56 бит (плюс 8 бит четности, которые не используются в алгоритме).
*   **Уязвимости**: Из-за короткой длины ключа (56 бит) DES уязвим к атакам полного перебора (брутфорс). В 1999 году машина EFF Deep Crack взломала DES менее чем за 24 часа.
*   **Замена**: Хотя одиночный DES устарел, его улучшенная версия – Triple DES (3DES), которая использует DES трижды с двумя или тремя ключами, все еще применяется в некоторых старых системах, но постепенно вытесняется AES.

#### 4.2. AES (Advanced Encryption Standard / Rijndael)

*   **История**: Выбран NIST в 2001 году в качестве преемника DES. Разработан бельгийскими криптографами Йоаном Дайменом и Винсентом Райменом (Rijndael).
*   **Архитектура**: SP-сеть.
*   **Параметры**:
    *   Размер блока: 128 бит.
    *   Длина ключа: 128, 192 или 256 бит.
    *   Количество раундов: 10, 12 или 14 в зависимости от длины ключа.
*   **Особенности**: Отличается высокой скоростью, эффективностью и криптостойкостью. Широко используется во всем мире, считается текущим золотым стандартом симметричного шифрования.

#### 4.3. ГОСТ Р 28147-89 (Магма)

*   **История**: Российский стандарт шифрования, введен в 1989 году. Является национальным стандартом Российской Федерации.
*   **Архитектура**: 32-раундовая сеть Фейстеля.
*   **Параметры**:
    *   Размер блока: 64 бита.
    *   Длина ключа: 256 бит.
*   **Особенности**: Использует фиксированные S-блоки, которые изначально могли быть секретными, но сейчас стандартизированы. Благодаря длинному ключу и большому числу раундов, "Магма" обладает высокой криптостойкостью, но его 64-битный блок делает его уязвимым к атакам на основе дня рождения при больших объемах зашифрованных данных.

#### 4.4. DSt 1105:2009 (Кузнечик / ГОСТ Р 34.12-2015)

*   **История**: Вероятно, под "DSt 1105:2009" подразумевается современный российский стандарт блочного шифрования, который в настоящее время известен как "Кузнечик" (Kuznyechik), определенный в ГОСТ Р 34.12-2015. Он был введен для замены устаревающего ГОСТ Р 28147-89.
*   **Архитектура**: SP-сеть.
*   **Параметры**:
    *   Размер блока: 128 бит.
    *   Длина ключа: 256 бит.
    *   Количество раундов: 9.
*   **Особенности**: "Кузнечик" использует фиксированные S-блоки и имеет значительно более сложную раундовую функцию по сравнению с "Магмой". Он является современным и высокопроизводительным алгоритмом, соответствующим мировым стандартам безопасности.

#### 4.5. Камелия (Camellia)

*   **История**: Разработан японской компанией NTT в 2000 году. Включен в ISO/IEC 18033-3, является одним из шифров, рекомендованных проектом CRYPTREC для японского правительства и проектом eSTREAM.
*   **Архитектура**: Гибридная структура, сочетающая сеть Фейстеля с SP-сетью. Использует 18 раундов для 128-битного ключа и 24 раунда для 192/256-битных ключей.
*   **Параметры**:
    *   Размер блока: 128 бит.
    *   Длина ключа: 128, 192 или 256 бит.
*   **Особенности**: По характеристикам безопасности и производительности сравним с AES. Имеет две "F-функции", которые используются для увеличения криптостойкости.

#### 4.6. IDEA (International Data Encryption Algorithm)

*   **История**: Разработан Йоханом Масcеем и Сюзи Дженнер в 1991 году в Швейцарии. Использовался в PGP (Pretty Good Privacy) до того, как был заменен на более современные алгоритмы.
*   **Архитектура**: Не является ни чистой сетью Фейстеля, ни SP-сетью. Использует комбинацию операций из трех алгебраических групп: XOR (побитовое сложение по модулю 2), сложение по модулю $2^{16}$ и умножение по модулю $2^{16}+1$.
*   **Параметры**:
    *   Размер блока: 64 бита.
    *   Длина ключа: 128 бит.
    *   Количество раундов: 8.
*   **Особенности**: Один из первых блочных шифров, активно использующих умножение по модулю для обеспечения перемешивания. Долгое время считался очень безопасным.

#### 4.7. Иглобрюх (Blowfish)

*   **История**: Разработан Брюсом Шнайером в 1993 году как быстрая, бесплатная и безопасная альтернатива DES.
*   **Архитектура**: 16-раундовая сеть Фейстеля.
*   **Параметры**:
    *   Размер блока: 64 бита.
    *   Длина ключа: переменная, от 32 до 448 бит.
*   **Особенности**: Отличается очень сложной процедурой генерации подраунд-ключей, которая включает в себя множество итераций шифрования, делая ее относительно медленной. Это затрудняет атаки полного перебора ключей и использование аппаратных ускорителей. После генерации ключей шифрование и дешифрование очень быстрые. Не подходит для приложений, где ключ меняется часто, но хорош для долговременных ключей. Из-за 64-битного блока, как и DES и ГОСТ 28147-89, имеет ограничения в объеме данных, которые можно безопасно зашифровать в одном режиме без риска атак на основе дня рождения.

 

**Выводы**:
Блочные шифры являются краеугольным камнем современной криптографии. Их конструкция, будь то сеть Фейстеля или SP-сеть, определяет их свойства и производительность. Выбор режима шифрования блоков критичен для обеспечения желаемых свойств безопасности (конфиденциальность, целостность) и эффективности при работе с данными различной длины. Современные блочные шифры, такие как AES и Кузнечик, демонстрируют высокий уровень криптостойкости и производительности, делая их пригодными для защиты конфиденциальной информации в самых разнообразных приложениях. Однако понимание ограничений старых шифров, таких как DES, и правильное применение режимов шифрования является ключевым для построения надежных криптографических систем.